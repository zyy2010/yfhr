$(function(){$("#myModalAdd, #myModalEdit").modal({backdrop:"static",show:false});initData();$("#search").on("click",function(){initData()});$("#reset").on("click",function(){setTimeout(function(){initData()},100)});$("#newAddBox").on("click",function(){$("#formAddInfo").find(".errorTips").css("display","none");getPcode("#addPcode")});$("#newAddBtn").on("click",function(){var isAddNameVal=isAddName("#formAddInfo");if(!isAddNameVal){return false}var params=$$.serializeToJson("#formAddInfo",true);$.ajax({type:"POST",url:appId+"/organization/add",contentType:"application/json",headers:{token:token},data:JSON.stringify(params),success:function(data){if(data&&data.code==0){$("#table").bootstrapTable("refresh",{url:appId+"/organization/list"});$("#myModalAdd").modal("hide");clearFrom("#formAddInfo")}else{zq.error(data.msg);dialogClose()}}})});$("#editBtn").on("click",function(){var isAddNameVal=isAddName("#formEdit");if(!isAddNameVal){return false}var params=$$.serializeToJson("#formEdit",true);$.ajax({type:"PUT",url:appId+"/organization/modify",contentType:"application/json",headers:{token:token},data:JSON.stringify(params),success:function(data){if(data&&data.code==0){$("#table").bootstrapTable("refresh",{url:appId+"/organization/list"});$("#myModalEdit").modal("hide");clearFrom("#formAddInfo")}else{zq.error(data.msg);dialogClose()}}})});$("#export").on("click",function(){var jsonData=$$.serializeToJson("#formHeader",true);var login_name=encodeURIComponent(token);window.location.href=appId+"/organization/export?exportName=organization"+"&token="+login_name+"&"+$.param(jsonData)});$("#formAddInfo").find('input[field="name"]').on("input",function(){isAddName("#formAddInfo")});$("#myModalEdit").find('input[field="name"]').on("input",function(){isAddName("#myModalEdit")});$(document).on("click",".close, .cancel",function(){clearFrom("#formAddInfo");clearFrom("#myModalEdit")})});function dialogClose(){$(".dialogClose, .dialog button").on("click",function(){$(".dialog").fadeOut(500)})}function isAddName(selector){var name=$(selector).find('input[field="name"]').val();if(!name){$(selector).find(".errorTips").css("display","block");return false}else{$(selector).find(".errorTips").css("display","none");return true}}function handle4Edit(id){$("#formEdit").find(".errorTips").css("display","none");getPcode("#editPcode");$.ajax({type:"GET",url:appId+"/organization/search/"+id,headers:{token:token},success:function(data){if(data&&data.code==0){var oData=data.data;for(var s in oData){$("#formEdit").find("[field = "+s+"]").val(oData[s])}}else{zq.error(data.msg);dialogClose()}}})}function getPcode(selector){$.ajax({type:"GET",url:appId+"/organization/comboOrgan",headers:{token:token},success:function(data){if(data&&data.code==0){var str='<option value="">请选择</option>';var oData=data.data;for(var i=0;i<oData.length;i++){str+='<option value="'+oData[i].value+'">'+oData[i].text+"</option>"}$(selector).html(str)}else{zq.error(data.msg);dialogClose()}}})}function initData(data){var jsonData=$$.serializeToJson("#formHeader",true);$(".panel-body").height($("body").height()-$(".panel-heading").outerHeight()-32);$("#table").bootstrapTable("destroy");$("#table").bootstrapTable({url:appId+"/organization/list",method:"GET",cache:false,striped:true,pagination:true,pageList:[10,20],pageSize:10,pageNumber:1,sidePagination:"server",checkboxHeader:false,ajaxOptions:{headers:{token:token}},queryParams:function(params){jsonData.pageSize=params.limit;jsonData.pageNum=params.offset/params.limit+1;return jsonData},sortName:"id",sortOrder:"desc",columns:[{title:"操作",align:"center",valign:"middle",width:100,formatter:function(value,row,index){return'<button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModalEdit" onclick="handle4Edit(\''+row.id+"')\">编辑</button>"}},{field:"code",title:"组织编号",align:"center",valign:"middle",width:120},{field:"name",title:"组织名称",align:"center",valign:"middle"},{field:"type",title:"组织类型",align:"center",valign:"middle"},{field:"pname",title:"上级组织名称",align:"center",valign:"middle"},{field:"master",title:"组织负责人",align:"center",valign:"middle"},{field:"siteAddress",title:"组织地址",align:"center",valign:"middle"},{field:"creator",title:"创建人",align:"center",valign:"middle"},{field:"createTime",title:"创建时间",align:"center",valign:"middle"},{field:"updateTime",title:"修改时间",align:"center",valign:"middle"}],onLoadSuccess:function(){},onLoadError:function(){}})}